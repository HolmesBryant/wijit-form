<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Test Suite</title>
	<script defer type="module" src="/wijit-form.js"></script>
	<script defer type="module" SRC="/tester.js"></script>
</head>
<body>
	<wijit-form>
		<form action="/test-server.php">
			<input name="name">
		</form>
	</wijit-form>

	<script>
		const name = 'wijit-form';
		const subject = document.querySelector(name);
		const options = {
			fetchOptions: [null, '{"mode":"same-origin"}'],
			waiting: [null, '<h1>waiting</h1>', '<header><h1>waiting</h1></header>', '<h1>{{data.name}}</h1>'],
			success: [null, '<h1>success</h1>', '<header><h1>success</h1></header>', '<h1>success</h1>{{data.name}}'],
			error: [null, '<h1>error</h1>', '<header><h1>error</h1></header>', '<h1>error</h1>{{data.name}}'],
			response: ['html', 'json'],
			forceError: ['true', 'false'],
			modal: ['true', 'false'],
			reset: ['true', 'false']
		};

		function getAllCombinations(options) {
			return Object.entries(options).reduce(
				(acc, [key, values]) =>
				acc.flatMap((combination) =>
					values.map((value) => ({ ...combination, [key]: value }))
				),
				[[]]
			);
		}

		function camelToKebab(str) {
			return str.replace(/([a-z0-9])([A-Z])/g, '$1-$2').toLowerCase();
		}

		function setAttributes(attrs, subject) {
			for (let attr in attrs) {
				attr = camelToKebab(attr);
				subject.setAttribute(attr, attrs[attr]);
			}
		}

		async function init(subject, options) {
			let result;
			const combos = getAllCombinations(options);

			setAttributes(combos[0], subject);
			result = subject.shadowRoot;
			console.log(result);

			/*for (const combo of combos) {
				try {
					setAttributes(combo, subject);
					const result = await submitForm(subject);
					console.log(result);
				} catch (error) {
					console.error(error, combo);
				}

			}*/
		}

		customElements.whenDefined(name)
		.then (result => {console.log(result.testing)})
		// init(subject, options);

	</script>
</body>
</html>
