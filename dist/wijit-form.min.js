/**
 * @author Holmes Bryant <https://github.com/HolmesBryant>
 * @license GPL-3.0
 */
export default class WijitForm extends HTMLElement{#t=!1;#n="dialog-message";#e={};#r=!1;#o=!1;#i=!0;#s=!0;#a="json";#l;#c;#d;errorElems;successElems;waitingElems;default={success:"<h3>Submission Received</h3><p>Thank you!</p>",error:"<h3>Oopsie!</h3><p>There was an error. Your submission was not received.</p>",waiting:"<h1>Please Wait...</h1>"};dialog;testing=!1;static observedAttributes=["custom-css","dialog-message-id","error","fetch-options","force-error","modal","reset-form","response","success","waiting"];constructor(){super(),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML='\n\t\t\t<style id="wijit-form-css">\n\t\t\t\t@layer wijit-form {\n\t\t\t\t\thtml, body * { box-sizing: border-box; }\n\n\t\t\t\t\twijit-form {\n\t\t\t\t\t\t    --bg1-color: rgb(250,250,250);\n\t\t\t\t\t\t    --bg2-color: rgb(245,245,245);\n\t\t\t\t\t\t    --bg3-color: white;\n\t\t\t\t\t\t    --text-color: rgb(60,60,60);\n\t\t\t\t\t\t    --border-color: silver;\n\t\t\t\t\t\t    --fail-color: hsl(6, 93%, 80%);\n\t\t\t\t\t\t    --pass-color: hsl(112, 70%, 75%);\n\t\t\t\t\t\t    --accent-color: lightskyblue;\n\t\t\t\t\t\t    --min: 2.5rem;\n\t\t\t\t\t\t    --pad: .25rem;\n\n\t\t\t\t\t\t    background-color: var(--bg1-color);\n\t\t\t\t\t\t    border-radius: 10px;\n\t\t\t\t\t\t    color: var(--text-color);\n\t\t\t\t\t\t    display: inline-block;\n\t\t\t\t\t\t    padding: 1rem;\n\t\t\t\t\t\t    width: 100%;\n\t\t\t\t\t\t    overflow: auto;\n\t\t\t\t\t\t    scrollbar-gutter: stable both-edges;\n\t\t\t\t\t\t\t\tscrollbar-color: var(--bg2-color) var(--bg3-color);\n\n\t\t\t\t\t}\n\n\t\t\t\t\t@media (prefers-color-scheme: dark) {\n\t\t\t\t\t\t \t\twijit-form {\n\t\t\t\t\t        --text-color: rgb(240,240,240);\n\t\t\t\t\t        --bg1-color: rgb(35,35,35);\n\t\t\t\t\t        --bg2-color: rgb(40,40,40);\n\t\t\t\t\t        --bg3-color: rgb(60,60,60);\n\t\t\t\t\t\t\t    --accent-color: dodgerblue;\n\t\t\t\t\t        --border-color: dimgray;\n\t\t\t\t\t\t \t\t}\n\t\t\t\t    }\n\t\t\t\t} /* layer */\n\n\t\t    /*********************/\n\t\t    /**** Backgrounds ****/\n\t\t    /*********************/\n\n\t\t\t    wijit-form details > *,\n\t\t\t    wijit-form fieldset,\n\t\t\t    wijit-form section\n\t\t\t    { background-color: var(--bg2-color); }\n\n\t\t\t    wijit-form button,\n\t\t\t    wijit-form input,\n\t\t\t    wijit-form input::before,\n\t\t\t    wijit-form progress,\n\t\t\t    wijit-form select,\n\t\t\t    wijit-form textarea\n\t\t\t    { background-color: var(--bg3-color); }\n\n\t\t\t    wijit-form hr\n\t\t\t    { background-color: silver; }\n\n\t\t\t    wijit-form .primary,\n\t\t\t    wijit-form option:checked\n\t\t\t    { background-color: var(--accent-color); }\n\n\t\t\t    wijit-form progress::-webkit-progress-value\n\t\t\t    { background-color: var(--accent-color); }\n\n\t\t\t\t\twijit-form progress::-moz-progress-bar\n\t\t\t\t\t{ background-color: var(--accent-color); }\n\n\t\t\t    wijit-form .error\n\t\t\t    { background-color: var(--fail-color); }\n\n\t\t\t    wijit-form .success\n\t\t\t    { background-color: var(--pass-color); }\n\n\t\t    /********************************/\n\t\t    /****** Borders / Outlines ******/\n\t\t    /********************************/\n\n\t\t\t    wijit-form button,\n\t\t\t    wijit-form fieldset,\n\t\t\t    wijit-form input,\n\t\t\t    wijit-form input::before,\n\t\t\t    wijit-form progress,\n\t\t\t    wijit-form select,\n\t\t\t    wijit-form textarea,\n\t\t\t    wijit-form .error,\n\t\t\t    wijit-form .success\n\t\t\t    { border: 1px solid var(--border-color); }\n\n\t\t\t    wijit-form option\n\t\t\t    { border-bottom: 1px solid var(--border-color); }\n\n\t\t\t    wijit-form hr,\n\t\t\t    wijit-form option:last-child\n\t\t\t    { border: none; }\n\n\t\t\t    wijit-form input:user-valid:not([type="submit"]):not([type="reset"])\n\t\t\t    { border-color: var(--pass-color) }\n\n\t\t\t    wijit-form :user-invalid\n\t\t\t    { border-color: var(--fail-color) }\n\n\t\t\t    wijit-form .success\n\t\t\t    { border-color: var(--pass-color); }\n\n\t\t\t    wijit-form .error\n\t\t\t    { border-color: var(--fail-color); }\n\n\t\t\t\t\twijit-form button,\n\t\t\t\t\twijit-form fieldset,\n\t\t\t\t\twijit-form hr,\n\t\t\t\t\twijit-form input,\n\t\t\t\t\twijit-form input::before,\n\t\t\t\t\twijit-form option,\n\t\t\t\t\twijit-form progress,\n\t\t\t\t\twijit-form progress::-webkit-progress-value,\n\t\t\t\t\twijit-form progress::-webkit-progress-bar,\n\t\t\t\t\twijit-form section,\n\t\t\t\t\twijit-form select,\n\t\t\t\t\twijit-form textarea,\n\t\t\t\t\twijit-form .error,\n\t\t\t\t\twijit-form .success\n\t\t\t\t\t{ border-radius: .5rem; }\n\n\t\t\t\t\twijit-form input[type="radio"],\n\t\t\t\t\twijit-form input[type="radio"]::before\n\t\t\t\t\t{ border-radius: 50%; }\n\n\t\t\t\t\twijit-form option\n\t\t\t\t\t{ border-radius: 0; }\n\n\t\t\t\t\twijit-form option:first-child\n\t\t\t\t\t{ border-radius: .5rem .5rem 0 0; }\n\n\t\t\t\t\twijit-form option:last-child\n\t\t\t\t\t{ border-radius: 0 0 .5rem .5rem; }\n\n\t\t\t    wijit-form :focus-visible\n\t\t\t    {\n\t\t\t    \tborder-color: transparent;\n\t\t\t    \toutline: 1px solid var(--accent-color);\n\t\t\t    }\n\n\t\t\t    wijit-form input:checked::before\n\t\t\t    { outline: 2px solid var(--accent-color); }\n\n\t\t    /******************************/\n\t\t    /*********** Accent ***********/\n\t\t    /******************************/\n\n\t\t\t    wijit-form input,\n\t\t\t    { accent-color: var(--accent-color); }\n\n\t\t    /******************************/\n\t\t    /************ Text ************/\n\t\t    /******************************/\n\n\t\t\t    wijit-form label.required:after\n\t\t\t    { color: var(--fail-color) }\n\n\t\t\t    wijit-form button,\n\t\t\t    wijit-form input,\n\t\t\t    wijit-form fieldset,\n\t\t\t    wijit-form label,\n\t\t\t    wijit-form legend,\n\t\t\t    wijit-form option,\n\t\t\t    wijit-form select,\n\t\t\t    wijit-form textarea\n\t\t\t    { color: var(--text-color); }\n\n\t\t\t    wijit-form input:checked::before {\n\t\t\t      color: var(--accent-color);\n\t\t\t    }\n\n\t\t\t    wijit-form option,\n\t\t\t    wijit-form button,\n\t\t\t    wijit-form input,\n\t\t\t    wijit-form fieldset,\n\t\t\t    wijit-form label,\n\t\t\t    wijit-form legend,\n\t\t\t    wijit-form option,\n\t\t\t    wijit-form select,\n\t\t\t    wijit-form textarea\n\t\t\t    {\n\t\t\t        font-size: 1rem;\n\t\t\t        letter-spacing: .1rem;\n\t\t\t    }\n\n\t\t\t    wijit-form input[type="checkbox"]::before,\n\t\t\t    wijit-form input[type="radio"]::before\n\t\t\t    { font-size: var(--min); }\n\n\t\t\t    wijit-form label.required:after\n\t\t\t    { font-size: small }\n\n\t\t\t    wijit-form button,\n\t\t\t    wijit-form input[type="reset"],\n\t\t\t    wijit-form input[type="submit"],\n\t\t\t    wijit-form label,\n\t\t\t    wijit-form legend,\n\t\t\t    wijit-form option,\n\t\t\t    wijit-form .error,\n\t\t\t    wijit-form .success\n\t\t\t    { font-weight:bold; }\n\n\t\t\t    wijit-form .error,\n\t\t\t    wijit-form .success\n\t\t\t    { text-align: center; }\n\n\t\t    /*********************/\n\t\t    /****** Shadows ******/\n\t\t    /*********************/\n\n\t\t\t    wijit-form  button:hover,\n\t\t\t    wijit-form input[type="submit"]:hover,\n\t\t\t    wijit-form input[type="reset"]:hover,\n\t\t\t    wijit-form option:hover\n\t\t\t    { box-shadow: 2px 2px 5px black; }\n\n\t\t\t    wijit-form button:active,\n\t\t\t    wijit-form input[type="submit"]:active,\n\t\t\t    wijit-form input[type="reset"]:active,\n\t\t\t    wijit-form option:active,\n\t\t\t    wijit-form option:checked\n\t\t\t    { box-shadow: inset 2px 2px 5px black; }\n\n\t\t    /*********************/\n\t\t    /******* Cursor ******/\n\t\t    /*********************/\n\n\t\t\t    wijit-form input[type="checkbox"],\n\t\t\t    wijit-form input[type="radio"],\n\t\t\t    wijit-form input[type="color"],\n\t\t\t    wijit-form input[type="range"],\n\t\t\t    wijit-form input[type="reset"],\n\t\t\t    wijit-form input[type="submit"],\n\t\t\t    wijit-form label,\n\t\t\t    wijit-form button,\n\t\t\t    wijit-form select\n\t\t\t    { cursor: pointer; }\n\n\t\t\t    wijit-form input:disabled,\n\t\t\t    wijit-form *[disabled]\n\t\t\t    { cursor: not-allowed; }\n\n\t\t    /*********************/\n\t\t    /***** Structure *****/\n\t\t    /*********************/\n\n\t\t\t    wijit-form button,\n\t\t\t    wijit-form input[type=submit],\n\t\t\t    wijit-form input[type=reset] {\n\t\t\t    \tmargin: 1rem;\n\t\t\t    }\n\n\t\t\t\t\twijit-form fieldset {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\t\tgap: 0.5rem;\n\t\t\t\t\t\toverflow: auto;\n\t\t\t\t  \tmin-inline-size: 200px;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form div {\n\t\t\t\t\t\talign-items: stretch;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\t\tgap: 0.5rem;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form div.row\n\t\t\t\t\t{ align-items: center; }\n\n\t\t\t\t\twijit-form div > *,\n\t\t\t\t\twijit-form fieldset > *,\n\t\t\t\t\twijit-form section > *\n\t\t\t\t\t{ flex: 1; }\n\n\t\t\t\t\twijit-form button,\n\t\t\t\t\twijit-form input {\n\t\t\t\t\tmax-height: var(--min);\n\t\t\t    \tmin-height: var(--min);\n\t\t\t    \tmin-width: var(--min);\n\t\t\t    \tpadding: var(--pad);\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form hr {\n\t\t\t\t\t\tmin-width: 100%;\n\t\t\t\t\t\tmax-height: 5px;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form .row > hr {\n\t\t\t\t\t\tmin-width: 5px;\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\tmax-width: 5px;\n\t\t\t\t\t\tmax-height: 100%;\n\t\t\t\t\t}\n\n\t\t\t    wijit-form input:disabled {\n\t\t\t      opacity: 0.7;\n\t\t\t    }\n\n\t\t\t\t\twijit-form input[type="checkbox"],\n\t\t\t\t\twijit-form input[type="radio"] {\n      \t\t\tappearance: none;\n\t\t\t      height: var(--min);\n\t\t\t      position: relative;\n\t\t\t      width: var(--min);\n\t\t\t    }\n\n\t\t\t    wijit-form input:checked::before {\n\t\t\t      content: "";\n\t\t\t      line-height: 0;\n\t\t\t      position: absolute;\n\t\t\t      display: flex;\n\t\t\t      height: 100%;\n\t\t\t      width: 100%;\n\t\t\t      align-items: center;\n\t\t\t      justify-content: center;\n\t\t\t    }\n\n\t\t\t    wijit-form input[type="checkbox"]:checked::before {\n\t\t\t    \tcontent: "✔";\n\t\t\t    }\n\n\t\t\t    wijit-form input[type="radio"]:checked::before {\n\t\t\t      content: "⬤";\n\t\t\t    }\n\n\t\t\t    wijit-form input[type="color"],\n\t\t\t    wijit-form input[type="checkbox"],\n\t\t\t    wijit-form input[type="radio"] {\n\t\t\t    \tflex: 0;\n\t\t\t    \tflex-basis: var(--min);\n\t\t\t    \tpadding: 0;\n\t\t\t    \twidth: var(--min);\n\t\t\t    }\n\n\t\t\t  \twijit-form input[type=range] {\n\t\t\t\t\t\t-webkit-appearance: none;\n\t\t\t\t\t\t-moz-appearance: none;\n\t\t\t\t\t\tappearance: none;\n\t\t\t\t\t\tinline-size: 100%;\n\t\t\t\t\t\tmin-height: 5px;\n\t\t\t\t\t\tmax-height: 5px;\n\t\t\t\t\t\tmax-width: 95%;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form input[type="range"]::-webkit-slider-thumb {\n\t\t\t\t\t\twidth: 35px;\n\t\t\t\t\t\theight: 35px;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form input[type="range"]::-moz-range-thumb {\n\t\t\t\t\t\twidth: 35px;\n\t\t\t\t\t\theight: 35px;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form label {\n\t\t\t\t\t\tflex: 0;\n\t\t\t\t\t\twhite-space: nowrap;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form option {\n\t\t\t\t\t\tpadding: 1rem;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form progress {\n\t\t\t\t\t\t-webkit-appearance: none;\n\t\t\t\t\t\t-moz-appearance: none;\n\t\t\t\t\t\tappearance: none;\n\t\t\t\t\t\tinline-size: 100%;\n\t\t\t\t\t\tmin-height: 1rem;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form progress::-webkit-progress-value\n\t\t\t\t\t{ min-height: 1rem; }\n\n\t\t\t\t\twijit-form section {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\tflex-wrap: wrap;\n\t\t\t\t\t\tgap: 0.5rem;\n\t\t\t\t\t\toverflow: auto;\n\t\t\t\t  \tmin-inline-size: 200px;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form section + section\n\t\t\t\t\t{ margin: 1rem 0; }\n\n\t\t\t\t\twijit-form select {\n\t\t\t    \tmin-height: var(--min);\n\t\t\t    \tmin-width: var(--min);\n\t\t\t    \tpadding: var(--pad);\n\t\t\t\t\t}\n\n\t\t\t    wijit-form textarea\n\t\t\t    {\n\t\t\t    \tmin-height: 5rem;\n\t\t\t    \tmin-width: 10rem;\n\t\t\t    \tpadding: var(--pad);\n\t\t\t    \twidth: 100%;\n\t\t\t    }\n\n\t\t\t    wijit-form .required:after {\n\t\t\t    \tcontent: "*";\n\t\t\t    \tfont-size: x-large;\n\t\t\t    \tvertical-align: super;\n\t\t\t    }\n\n\t\t\t    /* Classes */\n\n\t\t\t\t\twijit-form .center {\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\talign-content: center;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form .center > *\n\t\t\t\t\t{ flex: 1; }\n\n\t\t\t\t\twijit-form .end {\n\t\t\t\t\t\talign-content: flex-end;\n\t\t\t\t\t\tjustify-content: flex-end;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form .reverse.end {\n\t\t\t\t\t\talign-content: flex-start;\n\t\t\t\t\t\tjustify-content: flex-start;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form .end > *\n\t\t\t\t\t{ flex: 1; }\n\n\t\t\t\t\twijit-form .nowrap\n\t\t\t\t\t{ flex-wrap: nowrap}\n\n\t\t\t\t\twijit-form .reverse\n\t\t\t\t\t{ flex-direction: column-reverse; }\n\n\t\t\t\t\twijit-form .row\n\t\t\t\t\t{ flex-direction: row; }\n\n\t\t\t\t\twijit-form .row.reverse\n\t\t\t\t\t{ flex-direction: row-reverse; }\n\n\t\t\t\t\twijit-form .start {\n\t\t\t\t\t\talign-content: flex-start;\n\t\t\t\t\t\tjustify-content: flex-start;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form .reverse.start {\n\t\t\t\t\t\talign-content: flex-end;\n\t\t\t\t\t\tjustify-content: flex-end;\n\t\t\t\t\t}\n\n\t\t\t\t\twijit-form .start > *\n\t\t\t\t\t{ flex: 1; }\n\n\t\t\t</style>\n\n\t\t\t<style>\n\t\t\t\t:host {\n\t\t\t\t\t--fail-color: darksalmon;\n\t\t\t\t\t--pass-color: limegreen;\n\t\t\t\t}\n\n\t\t\t\tbutton {\n\t\t\t\t\tbackground-color: var(--accent-color);\n\t\t\t\t\tborder-color: var(--border-color);\n\t\t\t\t\tborder-radius: 5px;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tfont-size: large;\n\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\toutline-color: var(--accent-color);\n\t\t\t\t\tpadding: .5rem;\n\t\t\t\t}\n\n\t\t\t\tbutton:hover,\n\t\t\t\tbutton:focus {\n\t\t\t\t\tbox-shadow: 2px 2px 5px black;\n\t\t\t\t}\n\n\t\t\t\tbutton:active {\n\t\t\t\t\tbox-shadow: inset 2px 2px 5px black;\n\t\t\t\t}\n\n\t\t\t\tdialog {\n\t\t\t\t\tbackground: transparent;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\tcolor: var(--text-color);\n\t\t\t\t\toutline: none;\n\t\t\t\t\ttext-align: center;\n\t\t\t\t}\n\n\t\t\t\tdialog::backdrop {\n\t\t\t\t\tbackground-color: white;\n\t\t\t\t\tcolor: black;\n\t\t\t\t\topacity: 0.75;\n\t\t\t\t}\n\n\t\t\t\tdialog.modeless {\n\t\t\t\t\taccent-color: transparent;\n\t\t\t\t\tbackdrop-filter: blur(.3rem);\n\t\t\t\t\theight: 100%;\n\t\t\t\t\toutline: none;\n\t\t\t\t\toverflow: hidden;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\ttop: 0;\n\t\t\t\t\twidth: 100%;\n\t\t\t\t}\n\n\t\t\t\tdialog.modeless[open] {\n\t\t\t\t\tdisplay: table;\n\t\t\t\t}\n\n\t\t\t\t.hidden\n\t\t\t\t{ display: none; }\n\n\t\t\t\t#dialog-message {\n\t\t\t\t\tbackground-color: var(--bg3-color);\n\t\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\t\tborder-radius: 10px;\n\t\t\t\t\tdisplay: table-cell;\n\t\t\t\t\tpadding: 1rem;\n\t\t\t\t\tvertical-align: middle;\n\t\t\t\t}\n\n\t\t\t\tdialog.modeless #dialog-message {\n\t\t\t\t\ttransition: all 1s;\n\t\t\t\t}\n\n\t\t\t\t#dialog-message.waiting {\n\t\t\t\t\tbackground-color: transparent;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tmargin: auto;\n\t\t\t\t\tpadding: 0;\n\t\t\t\t\twidth: auto;\n\t\t\t\t}\n\n\t\t\t\t#dialog-message.error {\n\t\t\t\t\tborder-color: var(--fail-color);\n\t\t\t\t}\n\n\t\t\t\t#dialog-message.success {\n\t\t\t\t\tborder-color: var(--pass-color);\n\t\t\t\t}\n\n\t\t\t\t#wrapper {\n\t\t\t\t\tposition: relative;\n\n\t\t\t\t}\n\n\t\t\t\t@media (prefers-color-scheme: dark) {\n\t\t\t\t\tdialog::backdrop {\n\t\t\t\t\t\tbackground-color: black;\n\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t</style>\n\n\t\t\t<div id="wrapper">\n\t\t\t\t<slot></slot>\n\t\t\t\t<slot name="dialog">\n\t\t\t\t\t<dialog class="modeless">\n\t\t\t\t\t\t<div id="dialog-message">\n\t\t\t\t\t\t\t<slot name="message"></slot>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<form method="dialog" class="hidden">\n\t\t\t\t\t\t\t<button>OK</button>\n\t\t\t\t\t\t</form>\n\t\t\t\t\t</dialog>\n\t\t\t\t</slot>\n\t\t\t</div>\n\n\t\t\t<div hidden id="responses" style="display:none">\n\t\t\t\t<button aria-label="close" form="dialog-form">OK</button>\n\t\t\t\t<slot name="waiting"></slot>\n\t\t\t\t<slot name="success"></slot>\n\t\t\t\t<slot name="error"></slot>\n\t\t\t</div>\n\t\t',this.mainAbortController=new AbortController}connectedCallback(){this.form=this.querySelector("form"),this.dialog=this.querySelector("dialog")||this.shadowRoot.querySelector("dialog"),this.container=this.dialog.querySelector(`#${this.dialogMessageId}`),this.errorElems=this.querySelectorAll("[slot=error]"),this.successElems=this.querySelectorAll("[slot=success]"),this.waitingElems=this.querySelectorAll("[slot=waiting]"),this.customCss||this.addDefaultCss(),this.form&&this.form.addEventListener("submit",(t=>this.submitData(t)),{signal:this.mainAbortController.signal}),this.dialog.addEventListener("close",(t=>{this.reset&&this.resetFormElements(this.form)}),{signal:this.mainAbortController.signal}),this.addFocusListeners()}attributeChangedCallback(t,n,e){t.indexOf("-")>-1&&(t=(t=t.split("-").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join("")).replace(t.charAt(0),t.charAt(0).toLowerCase())),this[t]=e}disconnectedCallback(){this.mainAbortController.abort()}async submitData(t){let n,e;t.preventDefault();const r=new FormData(t.target),o="html"===this.response?"text/html":"application/json",i=this.setFetchOptions(t,o);if(this.testing||this.showDialog(this.waiting,null),-1===t.target.action.indexOf("false")?(n=t.target.action,this.#s=!0):this.#s=!1,"GET"===i.method||"HEAD"===i.method){let t=0;n+="?";for(const e of r.entries())n+=0===t?e.join("="):`&${e.join("=")}`,t++;n=encodeURI(n)}else i.body=r;if(this.#s){if(e=await this.fetchData(n,i),this.testing)return this.setMessage(e.data,e.status);this.showDialog(e.data,e.status)}else e=this.simulateServer(i),setTimeout((()=>{this.showDialog(e.data,e.status)}),1e3)}async fetchData(t,n){try{const e=await fetch(t,n),r=e.status,o=e.headers.get("Content-Type");return{data:o.includes("json")?await e.json():await e.text(),status:r}}catch(t){return{data:"<h1>Server Error</h1>",status:status}}}simulateServer(t){let n,e;const r=t.body,o="<p>This result is a simulation. No server side form processing was performed.";return t.data=Object.fromEntries(r.entries()),delete t.body,this.forceError?(e=500,"html"===this.response?(n="<h1>Error</h1><p>HTML response</p>",n+=o):n=t):(e=200,"html"===this.response?(n="<h1>Success</h1><p>HTML response</p>",n+=o):n=t),{data:n,status:e}}setFetchOptions(t,n){const e=this.fetchOptions?JSON.parse(JSON.stringify(this.fetchOptions)):{},r=t.target.getAttribute("method")||"POST";return e.method=r.toUpperCase(),e.headers=e.headers||{},e.headers.Accept=e.headers.Accept||n,e}showDialog(t,n){const{container:e,dialog:r,modal:o}=this,i=this.setMessage(t,n),s=this.dialog.querySelector("form[method=dialog]"),a=s.querySelector("input[type=submit], button");return i&&(e.innerHTML=i),e.append(s),n?(s.classList.remove("hidden"),a.focus()):s.classList.add("hidden"),o?(r.classList.remove("modeless"),r.showModal()):(r.classList.add("modeless"),r.show()),i}setMessage(t,n){const{waitingElems:e,errorElems:r,successElems:o,container:i}=this;let s,a,l;return this.clearMessage(),null===n?(s="waiting",a=e,i.classList.add("waiting")):n>399?(s="error",a=r,i.classList.add("error"),i.classList.remove("waiting")):(s="success",a=o,i.classList.add("success"),i.classList.remove("waiting")),null!==this[s]&&void 0!==this[s]?l="json"===this.response?this.replacePlaceholders(this[s],t):this[s]:a.length>0?("json"===this.response&&this.replaceNodeContents(a,t),a.forEach((t=>t.setAttribute("slot","message")))):l="html"===this.response?null===n?this.default[s]:t:this.default[s],l}replacePlaceholders(t,n){const e=/{{([^{}]+)}}/g;let r,o=t;for(;null!==(r=e.exec(o));){const t=r[1].split(".");let e=n;for(const n of t)if(e=e?.[n],void 0===e)break;o=o.replace(r[0],void 0===e?r[0]:JSON.stringify(e))}return o.replaceAll('"',"")}replaceNodeContents(t,n){const e=/{{([^{}]+)}}/g;for(const r of t){let t,o=r.innerHTML;for(;null!==(t=e.exec(o));){const e=t[1].split(".");let r=n;for(const t of e)if(r=r?.[t],void 0===r)break;o=o.replace(t[0],void 0===r?t[0]:r)}r.innerHTML=o}return t}addFocusListeners(){if(this.form)for(const t of this.form.elements)"textarea"!==t.localName&&t.addEventListener("focus",(()=>{"function"==typeof t.select&&t.select()}),{signal:this.mainAbortController.signal})}resetFormElements(t){const n=t.querySelectorAll("input, select, textarea");try{this.form.reset(),n[0].focus()}catch(t){console.debug(typeof this.form.reset,this.form),console.error(this)}}clearMessage(){this.container.classList.remove("error"),this.container.classList.remove("success");for(const t of this.waitingElems)t.setAttribute("slot","waiting");for(const t of this.errorElems)t.setAttribute("slot","error");for(const t of this.successElems)t.setAttribute("slot","success")}cleanHTML(t){const n=new Set(["p","span","h1","h2","h3","h4","h5","h6","b","strong","i","hr","br"]),e=new Set(["id","class","style"]),r=document.createElement("div");r.innerHTML=t;for(let t=r.childNodes.length-1;t>=0;t--){const o=r.childNodes[t];if(o.nodeType===Node.ELEMENT_NODE){if(!n.has(o.localName.toLowerCase())){r.replaceChild(document.createTextNode(o.textContent),o);continue}const t=Array.from(o.attributes).filter((t=>e.has(t.name)));o.attributes.length=0;for(const n of t)o.setAttribute(n.name,n.value)}}return r.innerHTML}validateJson(t){try{return JSON.parse(t)}catch(n){try{const n=t.replace(/['"<>;\s\t\n\r?()]/g,"").replace(/([\w:\/\\]+)/g,'"$&"');return JSON.parse(n)}catch(t){return!1}}}addDefaultCss(){document.head.querySelector("#wijit-form-css")||document.head.append(this.defaultCss())}defaultCss(){return this.shadowRoot.querySelector("#wijit-form-css")}get customCss(){return this.#t}set customCss(t){switch(t){case"":case"true":t=!0,this.addDefaultCss();break;default:t=!1,document.head.querySelector("style#wijit-form-css")&&style.remove()}this.#t=t}get dialogMessageId(){return this.#n}set dialogMessageId(t){this.#n=t}get fetchOptions(){return this.#e}set fetchOptions(t){t=this.validateJson(t),this.#e=null===t?{}:t}get forceError(){return this.#r}set forceError(t){let n=this.form.querySelector("input[name=fail]");switch(t.toLowerCase()){case"":case"true":case!0:t=!0,n||(n=document.createElement("input"),n.name="fail",n.value="true",n.type="hidden",this.form.append(n));break;default:t=!1,n&&n.remove()}this.#r=t}get modal(){return this.#o}set modal(t){switch(t.toLowerCase()){case"":case"true":t=!0;break;default:t=!1}this.#o=t}get resetForm(){return this.#i}set resetForm(t){switch(t.toLowerCase()){case"":case"true":t=!0;break;default:t=!1}this.#i=t}get response(){return this.#a}set response(t){this.#a=t.toLowerCase()}get error(){return this.#l}set error(t){if("null"===(t=this.cleanHTML(t)))t=null;this.#l=t}get success(){return this.#c}set success(t){if("null"===(t=this.cleanHTML(t)))t=null;this.#c=t}get waiting(){return this.#d}set waiting(t){if("null"===(t=this.cleanHTML(t)))t=null;this.#d=t}}document.addEventListener("DOMContentLoaded",customElements.define("wijit-form",WijitForm));
